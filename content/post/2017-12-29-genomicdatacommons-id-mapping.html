---
title: "GenomicDataCommons Example: UUID to TCGA and TARGET Barcode Translation"
author: Sean Davis
date: '2017-12-29'
topics:
  - GenomicDataCommons
  - Bioconductor
tags:
  - cancer informatics
  - bioinformatics
  - open data
  - TCGA
draft: false
---



<p>One of the features of the NCI Genomic Data Commons is that
<em>everything</em> has a unique identifier in the form of a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>. However,
because <em>many</em> legacy projects and much of the literature do not use
UUIDs but instead use <a href="https://wiki.nci.nih.gov/display/TCGA/TCGA+barcode">TCGA sample barcodes</a>, one simple use case for the
GenomicDataCommons package is to map from the UUID for a file or a set
of files back to the associated TCGA barcode(s).</p>
<p>Given a set of file ids (which I simulate here by fetching some from
the GDC API), I build a small function that maps those file UUIDs back
to the associated TCGA barcodes. Because the GDC also contains data
from TARGET as well as Foundation Medicine, the same code will return
associated legacy identifiers for those types of samples as well.</p>
<p>Get started by loading the <a href="https://bioconductor.org/packages/GenomicDataCommons">GenomicDataCommons</a> library:</p>
<pre class="r"><code>library(GenomicDataCommons)</code></pre>
<p>Fetch some file IDs:</p>
<pre class="r"><code>file_uuids = files() %&gt;% results(size=15) %&gt;% ids()
head(file_uuids)</code></pre>
<pre><code>## [1] &quot;d86ea2f8-93bb-42f3-a195-1914a4839bb4&quot;
## [2] &quot;79e05e92-e616-4690-b507-3ffc531e9e79&quot;
## [3] &quot;a39afa84-fbfb-4f0f-8176-5975f589fc83&quot;
## [4] &quot;8fa12ac8-68c8-454f-95f0-11dcf996c06c&quot;
## [5] &quot;7248e30c-367a-401f-a52a-315b7add965d&quot;
## [6] &quot;ee877659-00fa-4e88-8293-16317bd337b4&quot;</code></pre>
<p>The TCGA barcodes are nested in the file records, but we can access
them in the <code>cases.samples.submitter_id</code>. The
<code>available_fields</code> and <code>available_values</code> functions are useful
GenomicDataCommons package functions for examining available fields
and their associated values to find information of interest. Another
common approach is to fetch all available fields and then examine the
results using <code>str</code>.</p>
<pre class="r"><code>fres = files() %&gt;%
    select(available_fields(&#39;files&#39;)) %&gt;%
    results()
str(fres)</code></pre>
<p>In the code below, I simply start with a <code>files()</code> query against the
GenomicDataCommons API, filter to include only those files that match
the supplied <code>file_ids</code>, and then gather the
<code>cases.samples.submitter_id</code> and file UUIDs into a data frame. The
most complicated (and fragile, since it will break if the GDC changes
its data model) iw the lapply statement that accesses the barcodes in
the nested results returned.</p>
<pre class="r"><code>library(GenomicDataCommons)
library(magrittr)

TCGAtranslateID = function(file_ids, legacy = FALSE) {
    info = files(legacy = legacy) %&gt;%
        filter( ~ file_id %in% file_ids) %&gt;%
        select(&#39;cases.samples.submitter_id&#39;) %&gt;%
        results_all()
    # The mess of code below is to extract TCGA barcodes
    # id_list will contain a list (one item for each file_id)
    # of TCGA barcodes of the form &#39;TCGA-XX-YYYY-ZZZ&#39;
    id_list = lapply(info$cases,function(a) {
        a[[1]][[1]][[1]]})
    # so we can later expand to a data.frame of the right size
    barcodes_per_file = sapply(id_list,length)
    # And build the data.frame
    return(data.frame(file_id = rep(ids(info),barcodes_per_file),
                      submitter_id = unlist(id_list)))
    }</code></pre>
<p>Now, we can translate our example <code>file_uuids</code>:</p>
<pre class="r"><code>res = TCGAtranslateID(file_uuids)</code></pre>
<pre class="r"><code>head(res)</code></pre>
<pre><code>##                                file_id   submitter_id
## 1 d86ea2f8-93bb-42f3-a195-1914a4839bb4 AD16567_sample
## 2 79e05e92-e616-4690-b507-3ffc531e9e79 AD10500_sample
## 3 a39afa84-fbfb-4f0f-8176-5975f589fc83  AD6758_sample
## 4 8fa12ac8-68c8-454f-95f0-11dcf996c06c AD14707_sample
## 5 7248e30c-367a-401f-a52a-315b7add965d  AD1751_sample
## 6 ee877659-00fa-4e88-8293-16317bd337b4  AD4226_sample</code></pre>
<p>This little function is a bit “niche”, but it does illustrate how one
can leverage GenomicDataCommons package functionality to create useful
higher-level functionality like ID mapping.</p>
<ul>
<li>EDIT [01-02-2018]: Added <code>legacy</code> flag to function to allow mapping
of legacy file UUIDs. See <a href="http://disq.us/p/1ozinq7">comment below</a> for rationale.</li>
</ul>
